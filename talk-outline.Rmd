---
title: "Opinionated practices for teaching reproducibility:"
subtitle: "motivation, guided instruction <br>and practice"  
author: 
  - "Tiffany Timbers (UBC) </br> Joel Ostblom (UBC)"
  - "`r Sys.Date()`"
output:
  xaringan::moon_reader:
    lib_dir: libs
    css: xaringan-themer.css
    nature:
      highlightStyle: github
      highlightLines: true
      countIncrementalSlides: false
      slideNumberFormat: '%current%'
      titleSlideClass: [top, left]
      ratio: '16:9'

---

class: middle, center

```{r setup, include=FALSE}
options(htmltools.dir.version = FALSE)
knitr::opts_chunk$set(message = FALSE, 
                      echo = FALSE, 
                      warning = FALSE,
                      fig.align = "center")
```

```{r xaringan-themer, include=FALSE, warning=FALSE}
library(xaringanthemer)
style_duo_accent(
  primary_color = "#9F999C",
  secondary_color = "#FFE5F3",
  inverse_header_color = "#8F8C8E",
  link_color = "deeppink",
  title_slide_text_color = "#3d3d3d",
  title_slide_background_image = "img/title-slide-background-light.png",
  title_slide_background_position = "left",
  header_font_google = google_font("Josefin Sans"),
  text_font_google   = google_font("Montserrat", "300", "300i"),
  code_font_google   = google_font("Fira Mono")
)
```

```{css, echo = FALSE}
# source: https://community.rstudio.com/t/using-multiple-font-sizes-for-code-chunks/26405/6
.remark-slide-content {
  font-size: 18px;
  padding: 20px 80px 20px 80px;
}
.remark-code, .remark-inline-code {
  background: #f0f0f0;
}
.remark-code {
  font-size: 18px;
}
.huge .remark-code { /*Change made here*/
  font-size: 200% !important;
}
.small .remark-code { /*Change made here*/
  font-size: 80% !important;
}
.tiny .remark-code { /*Change made here*/
  font-size: 60% !important;
}
```



<img src="img/ostblom-timbers-2022.png" height=475>

[https://www.tandfonline.com/doi/pdf/10.1080/26939169.2022.2074922](https://www.tandfonline.com/doi/pdf/10.1080/26939169.2022.2074922)

---

### Reproducibility in data science courses at UBC


Courses where we **explicitly** teach reproducibility for data science

| Course   | Title                                | Level            | Reproducibility topic(s) |
|----------|--------------------------------------|------------------|--------------------------|
| [DSCI 100](https://ubc-dsci.github.io/dsci-100/README.html) | Introduction to data science         | undergraduate    | code for analysis, version control |
| [DSCI 310](https://ubc-dsci.github.io/dsci-310-student/) | Reproducible and trustworthy workflows for data science | undergraduate | file naming & organization, version control, reproducible reports, environments, data analysis pipelines, software packages |
| [DSCI 521](https://github.com/UBC-MDS/DSCI_521_platforms-dsci) | Computing platforms for data science | graduate         | file naming & organization, version control, reproducible reports, environments |
| 
| [DSCI 522](https://github.com/UBC-MDS/DSCI_522_dsci-workflows) | Data science workflows               | graduate         | version control, reproducible reports, environments, data analysis pipelines |
| [DSCI 524](https://github.com/UBC-MDS/DSCI_524_collab-sw-dev) | Collaborative software development   | graduate         | version control, software packages |

---



class: inverse, center, middle

## Data Science:

### *the study, development and practice* 
### *of reproducible and auditable processes* 
### *to obtain insight from data*

---


<br><br>

### Reproducible analysis:

#### *reaching the same result given the same input, computational methods and conditions*<sup>1</sup>.

<br><br>

--

### Auditable analysis,

#### *a readable record of the steps used to carry out the analysis as well as a record of how the analysis methods evolved*.<sup>2</sup>

<br><br>



.footnote[
[1] National Academies of Sciences, 2019

[2] Parker, 2017 and Ram, 2013
]

---


<br><br><br><br><br><br>

### Why do we adopt this definition?

- It is important that insights from data science are trustworthy

<!--Russell Hardin (https://as.nyu.edu/faculty/russell-hardin.html) wrote: 
‚Äú Trust involves giving discretion to another to affect one‚Äôs interests.‚Äù

Data science insights are very often used to make important, 
real-life decisions

-->

--

- Reproducible and auditable methods are one of the expectations for trustworthy data science

<!--

 Don Tapscott ( The Naked Corporation) describes trust as: 
 honest, considerate, accountable, and transparent.

"Francis Fukuyama‚Äôs definition of trust:
‚Äú Trust is the expectation that arises within a community of regular,
honest, and cooperative behavior, based on commonly shared norms, 
on the part of other members of that community.‚Äù"

-->

---

<br><br><br><br><br>

### We cannot trust non-reproducible and non-auditable analyses because they:

--

1. lack evidence that the results could be regenerated

--

2. we don't know enough details of how they were created

--

3. there is an insufficient record of how and why analysis decisions were made

---

class: center, inverse

<!-- add a background of an image of a lagniappe-->

<br><br><br><br><br><br><br><br>

### The lagniappe of reproducibile data science methods:

--

### more effective collaboration!

<!--Data science is an inherently collaborative discipline, 
and adhering to reproducible and auditable data science methods 
greatly facilitates the act of collaborating in many contexts, 
further emphasizing the importance of learning this skill well.
-->

---

<br><br><br>

### Examples of things that can go wrong without reproducible practices

--

- An interesting result that you cannot recreate üòû

--

- Your email inbox is full of information related to the project that only you have access too üò´

--

- A small change to the analysis code requires re-running the entire thing, *and takes hours...* üòß

--

- Activation time to becoming productive after taking a break from the project is hours to days üò¥

--

- Code that can only be run on one machine, *and you don't know why...* üòµ

---

class: inverse, center, middle

### *So if reproducibility is so important for data science, why is it hard to teach it?*

---

<br><br><br><br><br><br>

<!-- add images to go along with each point-->

### Possibilities:

--

1. Students are more excited about generating insights from data than reproducibility

--

2. Lack of awareness of the problems with non-reproducible analyses

--

3. Reproducibility tools are not necessarily smooth and easy to learn

---

<br><br><br><br><br><br>

### Key things for teaching reproducibility

--

1. placing extra emphasis on motivation

--

2. guided instruction

--

3. lots of practice!!!

---

class: inverse, center, middle

# On placing extra emphasis on motivation:

---

class: center

### Git is hard!

<img src="https://imgs.xkcd.com/comics/git_2x.png" height=475>

*Source: https://xkcd.com/1597/*
---

### Git is hard!

Command to view the state of the repository 2 commits ago:
```bash
git checkout HEAD~2
```

Output ü§Ø:
```bash
Note: switching to 'HEAD~2'.

You are in 'detached HEAD' state. You can look around, make experimental
changes and commit them, and you can discard any commits you make in this
state without impacting any branches by switching back to a branch.

If you want to create a new branch to retain commits you create, you may
do so (now or later) by using -c with the switch command. Example:

  git switch -c <new-branch-name>

Or undo this operation with:

  git switch -

Turn off this advice by setting config variable advice.detachedHead to false

HEAD is now at cea9a00 updated site

```

---

### Git is hard!

<img src="img/jenny-bryan-burn-it-all-down.png" width=700>

---

class: center

### LaTeX errors are often cryptic to new learners

<img src="img/r-latex-error.png" height=500>

---

### Creating environments is painstakingly slow

Dockerfile that adds 3 packages to a [rocker](https://www.rocker-project.org/) 
Docker image:
```Docker
FROM rocker/verse:4.1.1

# install R packages
RUN apt-get update -qq && install2.r --error \
    --deps TRUE \
    plotly \
    GGally \
    cowplot

```

Build the Dockerfile:
```bash
time docker build .
[+] Building 198.4s (6/6) FINISHED
...
```

That took about 5 minutes to build on my Macbook pro!!!

---

class: middle

# Strategies for placing extra emphasis on motivation

1. Tell stories from the trenches

2. Study cases of failures with real world consequences

3. Let them fail (in a controlled manner)


---

### Tell stories from the trenches

Exercise prompt:

1. Think and write down a non-reproducible, or non-auditable, workflow 
you have used before at work, on a personal project, or in course work, 
that negatively impacted your work somehow 
(make sure to include this in the story). 
Here‚Äôs an example: <br> <br> *As a Masters student, I started to use R to do my statistical analysis. I obtained the results I needed from running my code in the R console and copying the results into the word document that was my manuscript. Six months later we were working on revisions requested by the reviewers and I could not remember which version of the code I ran to get my results. I eventually figured it out through much trial and error, but the process was inefficient and very stressful.*
<br>*‚Äì- Tiffany Timbers*

2. When prompted, paste your story in the Google doc (link to be shared in class)

---

### Tell stories from the trenches

Sample student story:

*"In my line of work, my colleagues and I heavily relied on SQL queries to withdraw data from database. She always forgot to save the queries while just sending me an excel file to read. Sometimes (Most of the time) when I cross checked the data, the result didn't match. It usually required hours of troubleshooting to figure out where the gap was between my query and her data. ¬Ø\_(„ÉÑ)_/¬Ø"*

-- Master of Data Science student, UBC

<br>

- **Reproducibility failure > methods not recorded as code** 
- **Impact of reproducibility failure > loss of time**

---

### Tell stories from the trenches

Sample student story:

*‚ÄúWhen I was working in my last job creating a database, I was working between two different computer systems. I had written the code on my local computer (a windows) but it was being deployed on a Linux command line system. To debug my code it was easier to do on my computer but certain lines of code were specific to the linux machine vs. the window machine. While I was using version control I had a really hard time keeping track of which script was which and it caused me to waste lots of time and energy trying to fix the issue‚Äù*

-- Master of Data Science student, UBC

<br>

- **Reproducibility failure > lack of a shippable and shareable computational environment** 
- **Impact of reproducibility failure > loss of time**


---

### Tell stories from the trenches

Exercise prompt for further engagement:

Follow the instructions below 
for each story share in the class stories from the trenches Google document.

- Read the story and reflect on which of the themes listed below 
was likely the biggest cause of the reproducibility 
or transparency failure described in the story. 

- Label the story with the emoji 
corresponding to the chosen theme from the table below:

| Reproducibility and transparency themes | Emoji label |
|-----------------------------------------|-------------|
| Code                                    | ‚å®Ô∏è (keyboard) |
| Computational environments              | üíª (laptop)  |
| Software design                         | üíæ (floppy disk) |
| Data analysis pipeline                  | ‚û°Ô∏è (right arrow) |
| Documentation                           | üìÑ (page facing up)
| Project organization                    | üóÉ (card file box)|
| Randomness                              | üé≤ (game die) |
| Version control                         | üìú (scroll) |

---

Exercise prompt for further engagement (cont'd):

- Re-read the story and reflect on what the primary cost was 
from the reproducibility or transparency failure described in the story. 

- Label the story with the emoji 
corresponding to the chosen cost from the table below:

| Reproducibility and transparency failure cost | Emoji label |
|-----------------------------------------------|-------------|
| Financial                                     | üí∏ (money with wings) |
| Reputational                                  | üéñ (military medal)  |
| Time                                          | üï∞ (mantelpiece clock) |
| Unfixable error                               | üí• (collision) |
| Work discarded.                               | üóëÔ∏è(wastebasket)|

---

class: inverse, center, middle

# On guided instruction:

---

class: center, middle

### *From our experience, reproducibility is not something that most people or students figure out on their own, or if they do, it is not an efficient process...*

---

class: middle

### Excerpt from Roger Peng's blog post on <br> ["The Role of Theory in Data Analysis"](https://simplystatistics.org/posts/2018-12-11-the-role-of-theory-in-data-analysis/):

#### *There is no need for a new data analyst to learn about reproducibility ‚Äúfrom experience‚Äù. We don‚Äôt need to lead a junior data analyst down a months-long winding path of non-reproducible analyses until they are finally bitten by non-reproducibility (and therefore ‚Äúlearn their lesson‚Äù). We can just tell them*

#### *"In the past, we‚Äôve found it useful to make our data analyses reproducible. Here‚Äôs a workflow to guide you in your own analyses."*

#### *With that one statement, we can ‚Äúcompress‚Äù over 20 years of experience.*

---

class: middle

### Strategies for guided instruction

1. Live demonstration

2. Pre-lecture activities

3. Worksheets

---

### Worksheets

<img src="img/worksheet.png" width=775>

[Link to worksheet](https://github.com/UBC-DSCI/dsci-100-assets/blob/master/2021-spring/materials/worksheet_05/worksheet_05.ipynb)

---
class: inverse, center, middle

# On lots of practice:
---

class: middle

### **Mastery of a subject often involves consolidating ideas, concepts and theories into long-term memory.** 

### **And consolidating most things into long-term memory requires repetition**<sup>1</sup>.

.footnote[
[1] Ebbinghaus, Hermann (1913). ‚ÄúMemory (ha ruger & ce bussenius, trans.)‚Äù
In: New York: Teachers College.(Original work published 1885) 39.
]
---

class: center, middle

### However, when we teach reproducibility workflows and skills, we want students to do more than learn them, we want them to use and practice them. 

### We want to actually change their habits or behaviours.

---

class: inverse, center, middle

# Habit formation

### *the triggering of behavior from contextual cues*<sup>1</sup>.

<!--In the context of reproducible workflows
these cues are the tasks that students desire to execute, such as saving a file
after adding new content or wanting to share a document with a colleague.-->

.footnote[
[1] Gardner, Benjamin and Amanda L. Rebar (Apr. 2019). ‚ÄúHabit Formation
and Behavior Change‚Äù. en. In: Oxford Research Encyclopedia of Psychology. Oxford University Press. isbn: 978-0-19-023655-7. doi: 10.1093/acrefore/9780190236557.013.129.
]

---

### How does habit formation help?

Habits protect individuals from motivational lapses, 
where a desired good behavior is not expressed 
due to a momentary lack of willpower<sup>1</sup>.

.pull-left[
<img src="https://media.giphy.com/media/3240pzelRQkjj9XaiK/source.gif">
*Source: https://giphy.com/gifs/reaction-3240pzelRQkjj9XaiK*
]

.pull-right[
- Non-reproducible workflows tend to be "easier" and life gets "busy"...

- Without reproducibility habits, 
its a perfect storm to do the non-reproducible alternative 
**(even when you know it's better!)**

- We want to get students to a point 
where they opt for the reproducible workflow ‚Äúby default‚Äù.
]


.footnote[
[1] Gardner, Benjamin and Amanda L. Rebar (Apr. 2019). ‚ÄúHabit Formation
and Behavior Change‚Äù. en. In: Oxford Research Encyclopedia of Psychology. Oxford University Press. isbn: 978-0-19-023655-7. doi: 10.1093/acrefore/9780190236557.013.129.
]

---

### How are habits formed?

- best learned through frequent, regular, and sustained cue exposure

- some studies have reported that the median is at least around 70 days 
before reaching the plateau phase of habit development<sup>1,2</sup>.

- ### habits == LOTS OF PRACTICE!

.footnote[
[1] Lally, Phillippa et al. (2010). ‚ÄúHow Are Habits Formed: Modelling Habit Formation in the Real World‚Äù. en. In: European Journal of Social Psychology
40.6, pp. 998‚Äì1009. issn: 1099-0992. doi: 10.1002/ejsp.674.

[2] Fournier, Marion et al. (Nov. 2017). ‚ÄúEffects of Circadian Cortisol on the Development of a Health Habit‚Äù. eng. In: Health Psychology: Official Journal
of the Division of Health Psychology, American Psychological Association
36.11, pp. 1059‚Äì1064. issn: 1930-7810. doi: 10.1037/hea0000510.
]

---

class: middle

### Strategies for lots of practice!!!

- "I do, you do"

- Create easy to access practice playgrounds

- Interleave reproduciblity practice with other data science tasks

---

### Create easy to access practice playgrounds

Some reproducibility workflows require some time consuming, 
or complex prerequisite work to have been done before it makes sense to do them.

In such cases. "pre-baking" exercises to a particular point
is helpful for providing practice opportunities.


.pull-left[
<img src="img/martha-stewart.png" width=500>

Source: https://peopletv.com/video/martha-bakes-angel-food-cake/
]

.pull-right[
Examples include:

- automating the running of scripts via a data analysis pipeline (e.g., Makefile)

- using `bookdown` or Jupyter book to automate figure and table numbering

- organizing GitHub issues into milestones and a project board ([example exercise](https://github.com/ttimbers/mds-homework))

- performing a code review on a pull requests ([example exercise](https://github.com/ttimbers/review-my-pull-request))
]

---

### Exercise: Practice reviewing a pull request

This is a hard task to get a lot of practice on! 

Why? 

Before a pull request can be reviewed, a lot needs to happen to set the stage:

- Setup a GitHub repository
- Commit some files
- Make a change on another branch (or in a forked repo)
- Open a pull request


---

class: middle, center

### Exercise: Practice reviewing a pull request

<img src="img/review-my-pr-repo.png" height=450>

[review-my-pull-request GitHub repository](https://github.com/ttimbers/review-my-pull-request)

---

class: middle, center

### Exercise: Practice reviewing a pull request

<img src="img/review-my-pr-demo.png" height=450>

[review-my-pull-request GitHub repository](https://github.com/ttimbers/review-my-pull-request)

---

class: inverse, center, middle

# Wrap up

---

class: middle

### Key things for teaching reproducibility

#### 1. Extra emphasis on motivation

#### 2. Guided instruction

#### 3. Lots of practice!!!

---

class: center, middle

<img src="https://media.giphy.com/media/x1yhRwlqxBiQU/source.gif" width=800>

*Source: https://giphy.com/gifs/opinion-the-big-lebowski-x1yhRwlqxBiQU*

---

class: middle

### Anectodal evidence

- reduced technical debt in UBC Master of Data Science Capstone projects 
as we have gained more experience teaching reproducibility

### Feedback from Alumni

- *"I had my [COMPANY] Git training today for the data engineers/scientists and I wanted to tell you that everything I learned in your class about git was extremely helpful. You did such an amazing job teaching everything we need to know about git and working in technology, (I personally think I learned much more in your class than in my training here in SF)."*

- *"...the use of Git and Docker and the strong focus on reproducibility are of the best technical skills our program offer."*

---

### References

Aboumatar, Hanan and Robert A. Wise (Oct. 2019). ‚ÄúNotice of Retraction.
Aboumatar et al. Effect of a Program Combining Transitional Care and
Long-Term Self-Management Support on Outcomes of Hospitalized Patients With Chronic Obstructive Pulmonary Disease: A Randomized Clinical Trial. JAMA. 2018;320(22):2335-2343.‚Äù In: JAMA 322.14, pp. 1417‚Äì1418. issn: 0098-7484. doi: 10.1001/jama.2019.11954.

Fournier, Marion et al. (Nov. 2017). ‚ÄúEffects of Circadian Cortisol on the Development of a Health Habit‚Äù. eng. In: Health Psychology: Official Journal
of the Division of Health Psychology, American Psychological Association
36.11, pp. 1059‚Äì1064. issn: 1930-7810. doi: 10.1037/hea0000510.

Gardner, Benjamin and Amanda L. Rebar (Apr. 2019). ‚ÄúHabit Formation
and Behavior Change‚Äù. en. In: Oxford Research Encyclopedia of Psychology. Oxford University Press. isbn: 978-0-19-023655-7. doi: 10.1093/acrefore/9780190236557.013.129.

Kelion, Leo (Oct. 2020). ‚ÄúExcel: Why Using Microsoft‚Äôs Tool Caused Covid19 Results to Be Lost‚Äù. en-GB. In: BBC News.

Lally, Phillippa et al. (2010). ‚ÄúHow Are Habits Formed: Modelling Habit Formation in the Real World‚Äù. en. In: European Journal of Social Psychology
40.6, pp. 998‚Äì1009. issn: 1099-0992. doi: 10.1002/ejsp.674.

National Academies of Sciences, Engineering, and Medicine and others
(2019). Reproducibility and replicability in science. National Academies
Press.

---

### References (continued)

Parker, Hilary (2017). ‚ÄúOpinionated analysis development‚Äù. In: PeerJ
Preprints 5, e3210v1.

Ram, Karthik (2013). ‚ÄúGit can facilitate greater reproducibility and increased
transparency in science‚Äù. In: Source code for biology and medicine 8.1,
pp. 1‚Äì8.

Wallensteen, Lena et al. (2018). ‚ÄúRetraction notice to" Evaluation of behavioral problems after prenatal dexamethasone treatment in Swedish adolescents at risk of CAH"[Hormones and Behavior 85C (2016) 5-11]‚Äù. In:
Hormones and behavior 103, p. 140.

Whitehouse, et al. (July 2021). ‚ÄúRetraction Note: Complex Societies Precede Moralizing Gods throughout World History‚Äù. en. In: Nature 595.7866, pp. 320‚Äì320. issn: 1476-4687. doi: 10.1038/s41586-021-03656-3.

Zeeberg, Barry R et al. (2004). ‚ÄúMistaken identifiers: gene name errors can
be introduced inadvertently when using Excel in bioinformatics‚Äù. In: BMC
bioinformatics 5.1, pp. 1‚Äì6.

Ziemann, Mark, Yotam Eren, and Assam El-Osta (2016). ‚ÄúGene name errors
are widespread in the scientific literature‚Äù. In: Genome biology 17.1, pp. 1‚Äì
3.

### Credits

[Title slide illustration](https://www.freepik.com/free-vector/couple-professionals-analyzing-graphs_6974868.htm) was created by pch.vector  - www.freepik.com.

---

### Acknowledgements

.pull-left[
UBC Master of Data Science teaching team (past and present)
- Tomas Beuzen
- Vincenzo Coia
- Giulio Valentino Dalla Riva
- Florencia D'Andrea
- Mike Gelbart
- Gittu George
- Varada Kolhatkar
- Rodolfo Lourenzutti
- Firas Moosvi
- Quan Nguyen
- [Joel Ostblom](https://joelostblom.com/) (co-author on this work)
- Alexi Rodr√≠guez-Arelis
- Arman Seyed-Ahmadi

DSCI 100 teaching team
  - Trevor Campbell
  - Melissa Lee
]

.pull-right[
2021-22 Master of Data Science teaching team
<img src="https://ubc-mds.github.io/img/team/group.jpeg">
]
---

class: inverse, center, middle

# Questions?



### @TiffanyTimbers

#### talk slides: *url-TBD*
#### paper: https://www.tandfonline.com/doi/pdf/10.1080/26939169.2022.2074922
